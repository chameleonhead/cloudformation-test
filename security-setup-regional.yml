AWSTemplateFormatVersion: 2010-09-09
Parameters:
  ConfigRole:
    Description: Role name for AWS Config
    Type: String
  ConfigBucket:
    Description: S3 Bucket for AWS Config
    Type: String
Conditions:
  IsUsEast1: !Equals [!Ref AWS::Region, "us-east-1"]
Resources:
  ConfigRecorder:
    Type: AWS::Config::ConfigurationRecorder
    Properties:
      Name: default
      RecordingGroup:
        AllSupported: true
        IncludeGlobalResourceTypes: !If [IsUsEast1, true, false]
      RoleARN: !Sub arn:aws:iam::${AWS::AccountId}:role/${ConfigRole}
  DeliveryChannel:
    Type: AWS::Config::DeliveryChannel
    Properties:
      Name: default
      ConfigSnapshotDeliveryProperties:
        DeliveryFrequency: Six_Hours
      S3BucketName: !Ref ConfigBucket
      SnsTopicARN: !Ref ConfigTopic
  ConfigTopic:
    Type: AWS::SNS::Topic
    Properties:
      TopicName: config-topic
  ConfigTopicPolicy:
    Type: AWS::SNS::TopicPolicy
    Properties:
      PolicyDocument:
        Id: ConfigTopicPolicy
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              Service: config.amazonaws.com
            Action: SNS:Publish
            Resource: !Ref ConfigTopic
      Topics:
        - !Ref ConfigTopic

  GuardDutyDetector:
      Type: AWS::GuardDuty::Detector
      Properties:
          Enable: True
          FindingPublishingFrequency: FIFTEEN_MINUTES

  Analyzer:
    Type: AWS::AccessAnalyzer::Analyzer
    Properties:
      AnalyzerName: iam-acess-analyzer
      Type: ACCOUNT

  SecurityHub:
      Type: AWS::SecurityHub::Hub
      Properties:
        Tags:
          key1: value1
          key2: value2
